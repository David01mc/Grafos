/* static/css/bubble-containment-fix.css - Corrección para contener burbujas dentro del grafo */

/* ========== CONTENEDOR PRINCIPAL DEL GRAFO ========== */
.network-container,
.network-full-height {
    /* IMPORTANTE: Cambiar de visible a hidden para contener las burbujas */
    overflow: hidden !important;
    position: relative !important;
    
    /* Asegurar que el contenedor tenga dimensiones definidas */
    width: 100% !important;
    height: 100% !important;
    
    /* Crear contexto de apilamiento para controlar el z-index */
    z-index: 1 !important;
}

/* ========== SVG DE BURBUJAS - CONTENIDO DENTRO DEL CONTENEDOR ========== */
.burbujas-svg {
    /* Mantener posición absoluta pero contenida */
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    
    /* CRÍTICO: Asegurar que el SVG no sobresalga */
    overflow: hidden !important;
    
    /* Z-index controlado para estar encima del grafo pero debajo de los controles */
    z-index: 2 !important;
    
    /* Sin eventos de mouse para no interferir */
    pointer-events: none !important;
    
    /* Recortar contenido que sobresalga */
    clip-path: inset(0) !important;
}

/* ========== GRUPOS TRANSFORMABLES - CONTENIDOS ========== */
.grupo-burbujas-transformable {
    /* Asegurar que las transformaciones no causen overflow */
    transform-origin: 0 0 !important;
    
    /* Limitar el área de las burbujas */
    overflow: visible !important; /* Necesario para las transformaciones */
}

/* ========== BURBUJAS INDIVIDUALES - CONTROL DE TAMAÑO ========== */
.burbuja-grupo {
    /* Asegurar que las burbujas no sean demasiado grandes */
    max-width: 300px !important;
    max-height: 200px !important;
    
    /* Recortar si es necesario */
    overflow: hidden !important;
    
    /* Transiciones suaves para cambios de tamaño */
    transition: all 0.3s ease !important;
}

/* ========== ETIQUETAS DE GRUPOS - CONTROL DE POSICIÓN ========== */
.etiqueta-grupo {
    /* Asegurar que las etiquetas no sobresalgan */
    max-width: 200px !important;
    
    /* Recortar texto largo */
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    
    /* Posicionamiento controlado */
    dominant-baseline: central !important;
    text-anchor: middle !important;
    
    /* Tamaño de fuente responsive */
    font-size: clamp(10px, 1.2vw, 16px) !important;
}

/* ========== MÁRGENES DE SEGURIDAD PARA EVITAR OVERFLOW ========== */
.network-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    
    /* Crear margen invisible para burbujas */
    border: 20px solid transparent;
    box-sizing: border-box;
    pointer-events: none;
    z-index: 0;
}

/* ========== MEJORAS PARA DIFERENTES TAMAÑOS DE PANTALLA ========== */
@media (max-width: 768px) {
    .burbuja-grupo {
        /* Burbujas más pequeñas en móviles */
        max-width: 150px !important;
        max-height: 100px !important;
    }
    
    .etiqueta-grupo {
        /* Texto más pequeño en móviles */
        font-size: clamp(8px, 2vw, 12px) !important;
        max-width: 120px !important;
    }
    
    /* Márgenes más pequeños en móviles */
    .network-container::before {
        border-width: 10px;
    }
}

@media (max-width: 480px) {
    .burbuja-grupo {
        /* Burbujas extra pequeñas en pantallas muy pequeñas */
        max-width: 100px !important;
        max-height: 80px !important;
    }
    
    .etiqueta-grupo {
        font-size: clamp(6px, 2.5vw, 10px) !important;
        max-width: 80px !important;
    }
}

/* ========== CONTROL DE ZOOM - EVITAR OVERFLOW EN ZOOM ALTO ========== */
@media screen and (min-resolution: 192dpi) {
    .burbuja-grupo {
        /* Compensar por pantallas de alta resolución */
        max-width: 250px !important;
        max-height: 150px !important;
    }
}

/* ========== FALLBACK PARA CONTENEDORES SIN DIMENSIONES FIJAS ========== */
.network-container:not([style*="height"]) {
    /* Si no tiene altura definida, usar viewport */
    min-height: 400px !important;
    max-height: 80vh !important;
}

.network-container:not([style*="width"]) {
    /* Si no tiene ancho definido, usar contenedor padre */
    min-width: 300px !important;
    max-width: 100% !important;
}

/* ========== MEJORAS PARA CONTENIDO DINÁMICO ========== */
.burbujas-svg[data-zoom="high"] .burbuja-grupo {
    /* Cuando el zoom es alto, hacer burbujas más pequeñas */
    transform: scale(0.8) !important;
}

.burbujas-svg[data-zoom="low"] .burbuja-grupo {
    /* Cuando el zoom es bajo, hacer burbujas un poco más grandes */
    transform: scale(1.1) !important;
}

/* ========== INDICADORES DE DEBUG (OPCIONAL) ========== */
.debug-container-bounds {
    outline: 2px dashed red !important;
    outline-offset: -2px !important;
}

.debug-svg-bounds {
    outline: 2px dashed blue !important;
    outline-offset: -2px !important;
}

/* ========== ANIMACIONES SEGURAS QUE NO CAUSAN OVERFLOW ========== */
@keyframes safe-pulse {
    0%, 100% { 
        transform: scale(1);
        opacity: 0.8;
    }
    50% { 
        transform: scale(1.05); /* Escala limitada */
        opacity: 1;
    }
}

.burbuja-grupo {
    /* Reemplazar animaciones que puedan causar overflow */
    animation: none !important;
}

/* ========== MEJORAS PARA TOOLTIPS Y INFORMACIÓN ADICIONAL ========== */
.grupo-tooltip {
    /* Asegurar que los tooltips no sobresalgan */
    max-width: 200px !important;
    word-wrap: break-word !important;
    
    /* Posicionamiento inteligente */
    transform: translateX(-50%) !important;
    left: 50% !important;
    
    /* Z-index alto para estar encima de todo */
    z-index: 1000 !important;
}

/* Si el tooltip está cerca del borde derecho */
.grupo-tooltip.near-right-edge {
    transform: translateX(-100%) !important;
    left: auto !important;
    right: 0 !important;
}

/* Si el tooltip está cerca del borde izquierdo */
.grupo-tooltip.near-left-edge {
    transform: translateX(0) !important;
    left: 0 !important;
}

/* ========== CONTENEDOR RESPONSIVE MEJORADO ========== */
.network-container-responsive {
    /* Contenedor que se ajusta automáticamente */
    width: 100% !important;
    height: 100% !important;
    min-height: 300px !important;
    max-height: calc(100vh - 200px) !important; /* Dejar espacio para controles */
    
    overflow: hidden !important;
    position: relative !important;
    
    /* Centrar contenido si es necesario */
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

/* ========== UTILIDADES DE DEPURACIÓN ========== */
.show-container-bounds {
    border: 3px solid red !important;
    background: rgba(255, 0, 0, 0.1) !important;
}

.show-svg-bounds .burbujas-svg {
    border: 2px solid blue !important;
    background: rgba(0, 0, 255, 0.1) !important;
}

/* ========== FIXES ESPECÍFICOS PARA CASOS EDGE ========== */

/* Cuando el grafo está vacío */
.network-container:empty::after {
    content: "Área del grafo vacía";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #ccc;
    font-style: italic;
}

/* Cuando hay scroll en el contenedor padre */
.network-container-scrollable {
    position: sticky !important;
    top: 0 !important;
    z-index: 10 !important;
}

/* ========== MEJORAS DE PERFORMANCE ========== */
.burbujas-svg {
    /* Optimizaciones para mejor rendimiento */
    will-change: transform !important;
    backface-visibility: hidden !important;
    transform-style: preserve-3d !important;
}

.burbuja-grupo {
    /* Optimizar cambios frecuentes */
    will-change: transform, opacity !important;
    backface-visibility: hidden !important;
}